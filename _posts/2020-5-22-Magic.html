<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>magic</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body><h1><b><u><img src="{{site.baseurl}}/assets/images/magic/magic.png"/></u></b></h1>only 2 open ports, ssh and http<br /><img src="{{site.baseurl}}/assets/images/magic/1-1.png" alt="{{site.baseurl}}/assets/images/magic/1-1.png" /><br /><br />http has a login portal that can be easily bypassed by sql injection<br /><img src="{{site.baseurl}}/assets/images/magic/1-2.png" alt="{{site.baseurl}}/assets/images/magic/1-2.png" /><br /><br />an image upload, as specified. maybe we can bypass this using magic bytes, if thats what the box name hints at?<br />so we take a standard php web shell and any jpeg image, and append the shell at the end of our image.<br /><div class="codebox"><div class="codebox"><span style="color:#ff9d00;font-weight:700">cat</span>&nbsp;shell.php&nbsp;&gt;&gt;&nbsp;image.jpeg.&nbsp;<span style="color:#ff9d00;font-weight:700">&amp;&amp;</span>&nbsp;<span style="color:#ff9d00;font-weight:700">mv</span>&nbsp;image.jpeg&nbsp;image.php.jpeg</div></div><br />and we have our payload<br />we can even check for file type and it returns as php<br /><img src="{{site.baseurl}}/assets/images/magic/1-3.png" alt="{{site.baseurl}}/assets/images/magic/1-3.png" /><br /><br />try to upload this and it easily bypasses the file check<br /><img src="{{site.baseurl}}/assets/images/magic/1-4.png" alt="{{site.baseurl}}/assets/images/magic/1-4.png" /><br /><br />the files uploaded are stored in /image/uploads (just open any image on the site in new tab)<br />execute the shell on the browser and we get a easy reverse shell as www-data<br /><img src="{{site.baseurl}}/assets/images/magic/1-5.png" alt="{{site.baseurl}}/assets/images/magic/1-5.png" /><br /><br />db.php5 contains credentias to mysql. they dont work for ssh or the login portal<br /><img src="{{site.baseurl}}/assets/images/magic/1-6.png" alt="{{site.baseurl}}/assets/images/magic/1-6.png" /><br /><br />we dump the database using mysqldump<br /><div class="codebox"><div class="codebox">mysqldump&nbsp;-u&nbsp;<span style="color:#3ad900;font-weight:400">'theseus'</span>&nbsp;-p&nbsp;Magic</div></div><br /><br />and we find creds for the login portal<br /><img src="{{site.baseurl}}/assets/images/magic/1-7.png" alt="{{site.baseurl}}/assets/images/magic/1-7.png" /><br /><br />switch over to theseus, and we own user. i also enabled myself ssh by adding my public key to authorized_hosts file<br /><img src="{{site.baseurl}}/assets/images/magic/1-8.png" alt="{{site.baseurl}}/assets/images/magic/1-8.png" /><br /><br />running linpeas I notice a binary named sysinfo<br />in order to see what exactly it did, i executed it from a second shell, and examined what it did in another shell via pspy<br />it ran a few commands to enumerate the system<br /><img src="{{site.baseurl}}/assets/images/magic/1-9.png" alt="{{site.baseurl}}/assets/images/magic/1-9.png" /><br /><br />i compared outputs of each command with the outputs as presented by the script, turns out lshw was being executed as root<br />so i created my own lshw and placed it in /tmp/exploit/<br /><div class="codebox"><div class="codebox"><span style="color:#ff9d00;font-weight:700">/</span>bin<span style="color:#ff9d00;font-weight:700">/bash</span></div></div> <br /><br />then changed the path variable<br /><div class="codebox"><div class="codebox"><span style="color:#ff9d00;font-weight:700">export</span>&nbsp;<span style="color:#7f0044;font-weight:400">PATH</span>=<span style="color:#ff9d00;font-weight:700">/</span>tmp<span style="color:#ff9d00;font-weight:700">/</span>exploit<span style="color:#ff9d00;font-weight:700">/:</span><span style="color:#7f0044;font-weight:400">$PATH</span></div></div><br /><br />and ran sysinfo. it instantly spawned root shell<br />however there was no output to any command? i dont know what happend<br /><img src="{{site.baseurl}}/assets/images/magic/1-10.png" alt="{{site.baseurl}}/assets/images/magic/1-10.png" /><br /><br />so maybe it is executing commands, but theres no output?to verify, i echod the root flag into a file in tmp and read it through user shell<br /><img src="{{site.baseurl}}/assets/images/magic/1-11.png" alt="{{site.baseurl}}/assets/images/magic/1-11.png" /><br />so we do have root</body></html>