<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>{{site.baseurl}}/craft</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body>ports 22,443 and 6022 are open<br />22 and 6022 are both ssh<br /><img src="{{site.baseurl}}/assets/images/craft/1-1.png" alt="{{site.baseurl}}/assets/images/craft/1-1.png" /><br /><br />443 is running a website {{site.baseurl}}/craft.htb with 2 external links api.{{site.baseurl}}/craft.htb and <br />domain.{{site.baseurl}}/craft.htb<br /><img src="{{site.baseurl}}/assets/images/craft/1-2.png" alt="{{site.baseurl}}/assets/images/craft/1-2.png" /> <img src="{{site.baseurl}}/assets/images/craft/1-3.png" alt="{{site.baseurl}}/assets/images/craft/1-3.png" /><br /><br />auth login prompts for credentials, standard http authentication<br /><img src="{{site.baseurl}}/assets/images/craft/1-4.png" alt="{{site.baseurl}}/assets/images/craft/1-4.png" /><br /><br />credentials to user dinesh are found in a file at gogs. the creds do not login to ssh, but does authenticate at this http authentication<br /><img src="{{site.baseurl}}/assets/images/craft/1-5.png" alt="{{site.baseurl}}/assets/images/craft/1-5.png" /> <br /><br />fix pushed by dinesh for issue "bogous abv values" has a function "eval()" being used. eval() is vulnerable since it directly takes user input without any sanitization<br /><img src="{{site.baseurl}}/assets/images/craft/1-6.png" alt="{{site.baseurl}}/assets/images/craft/1-6.png" /><br /><br /><br />another file found on the gogs interface can be modified and used to upload<br />and/or execute files on the server<br /><img src="{{site.baseurl}}/assets/images/craft/1-7.png" alt="{{site.baseurl}}/assets/images/craft/1-7.png" /><br /><br />what i did was upload a python reverse shell using 'wget' in the system('') and then execute it. i got a root shell inside a docker. file settings.py contains credentials to the database, also a dbtest.py file that interacted with the db was present <br /><br />I modified dbtest to examine the database.<br /><img src="{{site.baseurl}}/assets/images/craft/1-8.png" alt="{{site.baseurl}}/assets/images/craft/1-8.png" /><br />it dumped these credentials <br /><br />{'id': 1, 'username': 'dinesh', 'password': '4aUh0A8PbVJxgd'}<br />{'id': 4, 'username': 'ebachman', 'password': 'llJ77D8QFkLPQB'}<br />{'id': 5, 'username': 'gilfoyle', 'password': 'ZEU3N8WNM2rh4T'}<br /><br />we aldredy had credentials to dinesh. gilfoyle's creds work on gogs login while ebachmans dont.<br /><br />gilfoyle's gogs.{{site.baseurl}}/craft account reveals a hidden repo along ssh private key! bingo<br /><img src="{{site.baseurl}}/assets/images/craft/1-9.png" alt="{{site.baseurl}}/assets/images/craft/1-9.png" /><br /><br />and we own gilfoyle, he reused his password for the priv key<br /><img src="{{site.baseurl}}/assets/images/craft/1-10.png" alt="{{site.baseurl}}/assets/images/craft/1-10.png" /><br /><br /><br />while going through secret repo, i found secret.sh that indicates a command called vault. a quick search led me to Hashicorp's vault, you can check that out here &lt;<a href="https://github.com/hashicorp/vault">https://github.com/hashicorp/vault</a>&gt;<br /><img src="{{site.baseurl}}/assets/images/craft/1-11.png" alt="{{site.baseurl}}/assets/images/craft/1-11.png" /><br />notice how ssh is enabled?<br /><br /><img src="{{site.baseurl}}/assets/images/craft/1-12.png" alt="{{site.baseurl}}/assets/images/craft/1-12.png" /><br /><br />and we own root<br /><br /></body></html>