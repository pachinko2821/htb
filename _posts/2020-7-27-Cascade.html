<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Writeup</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body><h1><b><img src="{{site.baseurl}}/assets/images/cascade/cascade.png"></b></h1><br />Nmap reports many interesting ports to be open<br /><img src="{{site.baseurl}}/assets/images/cascade/14-1.png" alt="{{site.baseurl}}/assets/images/cascade/14-1.png" /><br /><br />Checking RPC, we find it allows null sessions with rpcclient<br />We can now enumerate the domain via RPC<br />use command “enumdomusers” to get a list of domain users and their rids'<br /><img src="{{site.baseurl}}/assets/images/cascade/14-2.png" alt="{{site.baseurl}}/assets/images/cascade/14-2.png" /><br /><br />That can come in use later. Lets check LDAP for now<br /><img src="{{site.baseurl}}/assets/images/cascade/14-3.png" alt="{{site.baseurl}}/assets/images/cascade/14-3.png" /><br /><br /><img src="{{site.baseurl}}/assets/images/cascade/14-4.png" alt="{{site.baseurl}}/assets/images/cascade/14-4.png" /><br /><br />Credentials! it looks like base64. Can be easily decoded (Note: I took this screenshot at a later point in time)<br /><img src="{{site.baseurl}}/assets/images/cascade/14-5.png" alt="{{site.baseurl}}/assets/images/cascade/14-5.png" /><br /><br />Credentials give access to smb share. There's a whole bunch of interesting info we find<br /><br /><img src="{{site.baseurl}}/assets/images/cascade/14-6.png" alt="{{site.baseurl}}/assets/images/cascade/14-6.png" /><br /><br /><img src="{{site.baseurl}}/assets/images/cascade/14-7.png" alt="{{site.baseurl}}/assets/images/cascade/14-7.png" /><br /><br /><img src="{{site.baseurl}}/assets/images/cascade/14-8.png" alt="{{site.baseurl}}/assets/images/cascade/14-8.png" /><br /><br /><img src="{{site.baseurl}}/assets/images/cascade/14-9.png" alt="{{site.baseurl}}/assets/images/cascade/14-9.png" /><br /><br />So another set of creds? This time for S.Smith. These can be decoded with irb<br /><img src="{{site.baseurl}}/assets/images/cascade/14-10.png" alt="{{site.baseurl}}/assets/images/cascade/14-10.png" /><br /><br />Authenticate will evil-winrm to own user<br /><img src="{{site.baseurl}}/assets/images/cascade/14-11.png" alt="{{site.baseurl}}/assets/images/cascade/14-11.png" /><br /><br /><br />There's a second ArkSvc user on the box. Usually multiple users on HTB means horizontal privesc<br />I was unable to find anything on the box, so revisited smb using s.smith's credentials. There was a new share available to greet me<br /><img src="{{site.baseurl}}/assets/images/cascade/14-12.png" alt="{{site.baseurl}}/assets/images/cascade/14-12.png" /><br /><br />A sqlite db file was present in it, so I downloaded that, and found another set of creds, for ArkSvc. They are encoded, however its not base64<br /><img src="{{site.baseurl}}/assets/images/cascade/14-13.png" alt="{{site.baseurl}}/assets/images/cascade/14-13.png" /><br /><br />I made a desperate attempt, and straight away googled the string and found this. maybe it was left behind by the creator, or maybe another HTB member.<br /><img src="{{site.baseurl}}/assets/images/cascade/14-14.png" alt="{{site.baseurl}}/assets/images/cascade/14-14.png" /><br /><br />Authenticate with the credentials to own ArkSvc<br /><img src="{{site.baseurl}}/assets/images/cascade/14-15.png" alt="{{site.baseurl}}/assets/images/cascade/14-15.png" /><br /><br />ArkSVC is a member of AD Recyclebin<br /><img src="{{site.baseurl}}/assets/images/cascade/14-16.png" alt="{{site.baseurl}}/assets/images/cascade/14-16.png" /><br /><br /><a href="https://www.lepide.com/how-to/restore-deleted-objects-in-active-directory.html">https://www.lepide.com/how-to/restore-deleted-objects-in-active-directory.html</a><br /><a href="https://community.spiceworks.com/topic/2077684-ad-tombstone-objects">https://community.spiceworks.com/topic/2077684-ad-tombstone-objects</a><br /><br /><div class="codebox"><div class="codebox"><span style="color:#00117f;font-weight:400">Get-ADObject</span>&nbsp;<span style="color:#ff9d00;font-weight:700">-Filter</span>&nbsp;{displayName&nbsp;<span style="color:#ff9d00;font-weight:700">-eq</span>&nbsp;<span style="color:#3ad900;font-weight:400">"TempAdmin"</span>}&nbsp;<span style="color:#ff9d00;font-weight:700">-</span>IncludeDeletedObjects<br /></div></div><br /><br /><img src="{{site.baseurl}}/assets/images/cascade/14-17.png" alt="{{site.baseurl}}/assets/images/cascade/14-17.png" /><br /><br /><br />found deleted user TempAdmin's password<br /><div class="codebox"><div class="codebox"><span style="color:#00117f;font-weight:400">Get-ADObject</span>&nbsp;<span style="color:#ff9d00;font-weight:700">-Filter</span>&nbsp;{displayName&nbsp;<span style="color:#ff9d00;font-weight:700">-eq</span>&nbsp;<span style="color:#3ad900;font-weight:400">"TempAdmin"</span>}&nbsp;<span style="color:#ff9d00;font-weight:700">-</span>IncludeDeletedObjects&nbsp;<span style="color:#ff9d00;font-weight:700">-</span>property&nbsp;<span style="color:#ff9d00;font-weight:700">*</span></div></div><br /><img src="{{site.baseurl}}/assets/images/cascade/14-18.png" alt="{{site.baseurl}}/assets/images/cascade/14-18.png" /><br /><br />Luckily it was base64 this time<br /><img src="{{site.baseurl}}/assets/images/cascade/14-19.png" alt="{{site.baseurl}}/assets/images/cascade/14-19.png" /><br /><br />Authenticate with evil-winrm to own Administrator. Remember from the mail we found that TempAdmin and Administrator have the same password<br /><img src="{{site.baseurl}}/assets/images/cascade/14-20.png" alt="{{site.baseurl}}/assets/images/cascade/14-20.png" /><br /></body></html>
